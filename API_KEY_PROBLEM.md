# ❌ Проблема с API ключом OpenRouter

## Диагностика

Проект полностью исправен, все пути настроены правильно:
- ✅ Структура папок корректна
- ✅ Все файлы на месте
- ✅ Конфигурация правильная
- ❌ **API ключ недействителен**

## Причина ошибки

Ошибка `Error code: 401 - {'error': {'message': 'User not found.'}}` означает:

1. **API ключ просрочен или удален** - ключ был удален на сайте OpenRouter
2. **Аккаунт не найден** - аккаунт OpenRouter заблокирован или удален
3. **Баланс исчерпан** - на счету нет средств для выполнения запросов

## Решение ✅

### Шаг 1: Проверка текущего ключа

Запустите проверку:
```bash
bin\test_api_key.bat
```

Или вручную:
```bash
python scripts\test_api_key.py
```

### Шаг 2: Получение нового ключа

1. **Перейдите на сайт OpenRouter:**
   - https://openrouter.ai/keys

2. **Войдите в аккаунт**
   - Если аккаунта нет - зарегистрируйтесь
   - Если забыли пароль - восстановите

3. **Проверьте существующие ключи:**
   - Нажмите "API Keys" в меню
   - Проверьте статус ключа `sk-or-v1-25e0ce62a29...`
   - Если ключ удален или не отображается - создайте новый

4. **Создайте новый ключ:**
   - Нажмите "Create API Key"
   - Дайте имя ключу (например, "Stock Analyzer")
   - Скопируйте ключ (он начинается с `sk-or-v1-`)
   - **ВАЖНО:** Сохраните ключ безопасно, он показывается только один раз!

5. **Проверьте баланс:**
   - https://openrouter.ai/credits
   - Минимум: $5 для начала работы
   - Рекомендуется: $10-20
   - Пополнить можно через карту или PayPal

### Шаг 3: Обновление конфигурации

Откройте файл `config.yaml` и обновите API ключ:

```yaml
# OpenRouter API конфигурация
openrouter:
  api_key: "sk-or-v1-ВАШ-НОВЫЙ-КЛЮЧ-ЗДЕСЬ"  # Вставьте новый ключ
  base_url: "https://openrouter.ai/api/v1"
```

**Пример:**
```yaml
openrouter:
  api_key: "sk-or-v1-abc123def456ghi789jkl012mno345pqr678stu901vwx234yz"
  base_url: "https://openrouter.ai/api/v1"
```

### Шаг 4: Проверка нового ключа

После обновления config.yaml запустите проверку:
```bash
bin\test_api_key.bat
```

Если видите:
```
✅ API КЛЮЧ РАБОТАЕТ!
```

Значит всё настроено правильно!

### Шаг 5: Запуск приложения

Теперь можно запускать:

**Веб-интерфейс:**
```bash
bin\start_web.bat
```

**CLI:**
```bash
bin\start.bat
```

## Проверка проекта

Для полной проверки всех путей и конфигурации:
```bash
bin\verify_project.bat
```

Или:
```bash
python scripts\verify_project.py
```

## Результаты проверки

### ✅ Всё в порядке:
- Структура папок: **OK**
- Файлы проекта: **OK**
- Конфигурация: **OK**
- Пути к данным: **OK**
- Скрипты запуска: **OK**

### ❌ Требует исправления:
- API ключ: **НЕДЕЙСТВИТЕЛЕН** (401 User not found)

## Стоимость использования

После получения нового ключа и пополнения баланса:

- **Анализ 1 акции через 3 модели:** ~$0.01-0.02
- **Анализ 10 акций:** ~$0.10-0.20
- **Анализ 100 акций:** ~$1.00-2.00

Рекомендуем начать с баланса **$10**, этого хватит на:
- ~500-1000 анализов акций
- ~50-100 полных запусков с 10 акциями
- Несколько недель регулярного использования

## Альтернативные решения

Если не хотите использовать платный OpenRouter API, можно:

1. **Использовать локальные модели** (требует изменения кода):
   - Ollama с моделями llama2/mistral
   - LocalAI
   - LM Studio

2. **Использовать другие API:**
   - OpenAI напрямую (без OpenRouter)
   - Anthropic Claude API
   - Google Gemini API

Но OpenRouter удобнее, так как позволяет использовать множество моделей через один ключ.

## Дополнительная помощь

### Частые вопросы

**Q: Ключ работал вчера, сегодня не работает**  
A: Проверьте баланс на https://openrouter.ai/credits - возможно средства закончились

**Q: Создал новый ключ, но всё равно ошибка 401**  
A: Убедитесь, что:
- Скопировали ключ полностью
- Не добавили лишних пробелов
- Сохранили config.yaml в UTF-8
- Перезапустили приложение

**Q: Где найти свой старый ключ?**  
A: Старые ключи нельзя просмотреть после создания. Создайте новый.

**Q: Сколько ключей можно создать?**  
A: Неограниченное количество. Можно создать отдельные ключи для разных проектов.

### Контакты поддержки

- OpenRouter support: support@openrouter.ai
- Документация: https://openrouter.ai/docs
- Discord: https://discord.gg/openrouter

---

**Дата:** 2026-02-04  
**Статус:** Проект исправен, требуется только обновление API ключа  
**Проверка путей:** ✅ Пройдена успешно
