# –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (v3.0)

## üìã –ü—Ä–æ–±–ª–µ–º–∞

–í –ø—Ä–æ–µ–∫—Ç–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–ª–∏—Å—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ LLM –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö:
- `config.yaml` (—Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç v2.x)
- `config/llm_config.yaml` (–Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç v3.0)

–≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –ø—É—Ç–∞–Ω–∏—Ü—É –∏ —É—Å–ª–æ–∂–Ω—è–ª–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π.

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

### –ù–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (v3.0)

```
config/
‚îú‚îÄ‚îÄ api_keys.yaml          # API –∫–ª—é—á–∏ (OpenRouter, Alphavantage)
‚îú‚îÄ‚îÄ llm_config.yaml        # –í–°–ï –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ LLM –∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ companies.json         # –°–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
‚îÇ
‚îú‚îÄ‚îÄ api_keys.example.yaml  # –ü—Ä–∏–º–µ—Ä—ã (–≤ Git)
‚îú‚îÄ‚îÄ llm_config.example.yaml
‚îî‚îÄ‚îÄ companies.example.json

config.yaml                 # –£—Å—Ç–∞—Ä–µ–≤—à–∏–π (—Ç–æ–ª—å–∫–æ –¥–ª—è v2.x)
```

### –ß—Ç–æ –≥–¥–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è

#### üìÅ `config/api_keys.yaml` (–Ω–æ–≤—ã–π)
```yaml
openrouter_api_key: "sk-or-v1-..."
alphavantage_api_key: ""
```

#### üìÅ `config/llm_config.yaml` (–Ω–æ–≤—ã–π, –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª)
```yaml
# –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
input:
  excel_file: "config/companies.json"

# OpenRouter
openrouter:
  base_url: "https://openrouter.ai/api/v1"

# –ú–æ–¥–µ–ª–∏ LLM
models:
  - name: "GPT-4 Turbo"
    id: "openai/gpt-4-turbo"
    temperature: 0.3
    max_tokens: 1500

# –ü—Ä–æ–º–ø—Ç—ã
system_prompt: |
  –¢—ã - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫...
  
prompt_template: |
  –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –¥–≤–∏–∂–µ–Ω–∏–µ –∞–∫—Ü–∏–∏ {ticker}...

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
database:
  path: "data/stocks.db"
  keep_history: true

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ—Ç–∏—Ä–æ–≤–æ–∫
price_updates:
  strategy: "daily"
  min_update_interval_minutes: 15

# –≠–∫—Å–ø–æ—Ä—Ç
export:
  output_path: "output/exports/{date}_analysis.xlsx"
  color_coding: true

# –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–æ–º–ø–∞–Ω–∏—è—Ö
company_info:
  fallback_to_llm: true
  cache_duration_days: 30
  llm_model: "openai/gpt-3.5-turbo"

# –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫
scheduler:
  enabled: false
  timezone: "Europe/Moscow"

# –í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
web_app:
  host: "0.0.0.0"
  port: 8501
  theme: "dark"

# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
logging:
  level: "INFO"
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
```

#### üìÅ `config/companies.json` (–Ω–æ–≤—ã–π)
```json
{
  "companies": [
    {
      "ticker": "AAPL",
      "name": "Apple Inc.",
      "sector": "Technology",
      "industry": "Consumer Electronics"
    }
  ],
  "last_updated": "2026-02-04T12:00:00"
}
```

#### üìÅ `config.yaml` (—É—Å—Ç–∞—Ä–µ–≤—à–∏–π)
–¢–µ–ø–µ—Ä—å —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ —Ç–æ–º, —á—Ç–æ —Ñ–∞–π–ª —É—Å—Ç–∞—Ä–µ–ª –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è v2.x.

## üîÑ –ú–∏–≥—Ä–∞—Ü–∏—è

### –î–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ï—Å–ª–∏ –≤—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —Å—Ç–∞—Ä—ã–π `config.yaml`:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é:**
   ```bash
   python scripts/migrate_to_v3.py
   ```

2. **–°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:**
   - –°–æ–∑–¥–∞—Å—Ç `config/api_keys.yaml` —Å –≤–∞—à–∏–º API –∫–ª—é—á–æ–º
   - –°–æ–∑–¥–∞—Å—Ç `config/llm_config.yaml` —Å–æ –≤—Å–µ–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
   - –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –∫–æ–º–ø–∞–Ω–∏–∏ –≤ `config/companies.json`
   - –°–æ—Ö—Ä–∞–Ω–∏—Ç —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é `config_backup_*.yaml`

### –î–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. **–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø—Ä–∏–º–µ—Ä—ã:**
   ```bash
   copy config\api_keys.example.yaml config\api_keys.yaml
   copy config\llm_config.example.yaml config\llm_config.yaml
   copy config\companies.example.json config\companies.json
   ```

2. **–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `config/api_keys.yaml`:**
   - –í—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π OpenRouter API –∫–ª—é—á

3. **–ì–æ—Ç–æ–≤–æ!** –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É–∂–µ —Å–æ–¥–µ—Ä–∂–∞—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã

### ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏
- **API –∫–ª—é—á–∏** ‚Üí `api_keys.yaml` (–≤ `.gitignore`)
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ LLM** ‚Üí `llm_config.yaml` (–≤ `.gitignore`)
- **–°–ø–∏—Å–æ–∫ –∫–æ–º–ø–∞–Ω–∏–π** ‚Üí `companies.json` (–≤ `.gitignore`)
- **–ü—Ä–∏–º–µ—Ä—ã** ‚Üí `*.example.*` (–≤ Git)

### ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- API –∫–ª—é—á–∏ –Ω–µ –ø–æ–ø–∞–¥—É—Ç –≤ Git —Å–ª—É—á–∞–π–Ω–æ
- –õ–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Å—Ç–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–º–∏
- Example-—Ñ–∞–π–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —Å—Ç—Ä—É–∫—Ç—É—Ä—É –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤

### ‚úÖ –£–¥–æ–±—Å—Ç–≤–æ
- –û–¥–∏–Ω —Ñ–∞–π–ª (`llm_config.yaml`) —Å–æ –≤—Å–µ–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- –ù–µ –Ω—É–∂–Ω–æ –∏—Å–∫–∞—Ç—å, –≥–¥–µ —á—Ç–æ —Ö—Ä–∞–Ω–∏—Ç—Å—è
- –õ–µ–≥–∫–æ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### ‚úÖ –ì–∏–±–∫–æ—Å—Ç—å
- JSON –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–π (–ª–µ–≥–∫–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ)
- YAML –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ (—É–¥–æ–±–Ω–æ —á–∏—Ç–∞—Ç—å –∏ –ø–∏—Å–∞—Ç—å)
- –ú–æ–∂–Ω–æ –∏–º–µ—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–æ—Ñ–∏–ª–µ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

## üîç –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç `config.yaml` –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

1. ‚úÖ **–ù–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (v3.0):**
   ```
   config/api_keys.yaml + config/llm_config.yaml
   ```

2. ‚ö†Ô∏è **–°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç (v2.x):**
   ```
   config.yaml
   ```

### –õ–æ–≥–∏–∫–∞ –≤ `main.py` –∏ `app.py`:

```python
def load_config():
    # –ü–æ–ø—ã—Ç–∫–∞ –∑–∞–≥—Ä—É–∑–∏—Ç—å v3.0
    if Path("config/api_keys.yaml").exists() and Path("config/llm_config.yaml").exists():
        # –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
        api_keys = yaml.safe_load(open("config/api_keys.yaml"))
        llm_config = yaml.safe_load(open("config/llm_config.yaml"))
        # –û–±—ä–µ–¥–∏–Ω—è–µ–º
        config = llm_config
        config['openrouter']['api_key'] = api_keys['openrouter_api_key']
        return config
    
    # Fallback –Ω–∞ v2.x
    elif Path("config.yaml").exists():
        return yaml.safe_load(open("config.yaml"))
    
    # –û—à–∏–±–∫–∞
    else:
        raise FileNotFoundError("–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!")
```

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã

–í –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏ –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è –±–æ–ª–µ–µ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:

### System Prompt
- ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (4-6 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π)
- ‚úÖ –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä—É—Å—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- ‚úÖ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –∏ —É—Ä–æ–≤–Ω–∏
- ‚úÖ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è –¥–ª—è –∏–Ω–≤–µ—Å—Ç–æ—Ä–∞

### Prompt Template
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Å —Å–µ–∫—Ü–∏—è–º–∏
- ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∞–Ω–∞–ª–∏–∑–∞: –ß–¢–û, –ü–û–ß–ï–ú–£, –ß–¢–û –ó–ù–ê–ß–ò–¢
- ‚úÖ –†–∞–∑–¥–µ–ª "–ö–õ–Æ–ß–ï–í–´–ï –§–ê–ö–¢–û–†–´" —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ —Ü–∏—Ñ—Ä–∞–º–∏
- ‚úÖ –£–≤–µ–ª–∏—á–µ–Ω `max_tokens` –¥–æ 1500 –¥–ª—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

1. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç** –¥–ª—è –≤—Å–µ—Ö –Ω–æ–≤—ã—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤
2. **–ú–∏–≥—Ä–∏—Ä—É–π—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ** —á–µ—Ä–µ–∑ `scripts/migrate_to_v3.py`
3. **–û–±–Ω–æ–≤–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** –≤ —Å–≤–æ–∏—Ö —Ñ–æ—Ä–∫–∞—Ö/–∫–æ–ø–∏—è—Ö
4. **–î–µ–ª–∏—Ç–µ—Å—å –æ–ø—ã—Ç–æ–º** —á–µ—Ä–µ–∑ Issues/Discussions

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-02-04  
**–í–µ—Ä—Å–∏—è:** 3.0  
**–ê–≤—Ç–æ—Ä:** Stock Quotes Team
